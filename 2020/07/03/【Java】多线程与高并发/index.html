

<!DOCTYPE html>
<html lang="zh-Hans" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/icon.png">
  <link rel="icon" href="/img/icon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="black">
  <meta name="description" content="猫是我">
  <meta name="author" content="不食花生的猫">
  <meta name="keywords" content="">
  <meta name="description" content="多线程与高并发 synchronized 篇进程 线程 协程&#x2F;纤程（Quasur）   线程：一个程序里不同的执行路径public static class T1 extends Thread&amp;#123;   @Override    public void run()&amp;#123;     System.out.println(&quot;Override Theme 中的 run 方法&quot;);   &amp;#12">
<meta property="og:type" content="article">
<meta property="og:title" content="【Java】多线程与高并发">
<meta property="og:url" content="http://jjjime.github.io/2020/07/03/%E3%80%90Java%E3%80%91%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91/index.html">
<meta property="og:site_name" content="我是猫">
<meta property="og:description" content="多线程与高并发 synchronized 篇进程 线程 协程&#x2F;纤程（Quasur）   线程：一个程序里不同的执行路径public static class T1 extends Thread&amp;#123;   @Override    public void run()&amp;#123;     System.out.println(&quot;Override Theme 中的 run 方法&quot;);   &amp;#12">
<meta property="og:locale">
<meta property="article:published_time" content="2020-07-03T02:33:59.000Z">
<meta property="article:modified_time" content="2022-06-17T21:51:06.615Z">
<meta property="article:author" content="不食花生的猫">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="进阶">
<meta name="twitter:card" content="summary_large_image">
  
  <title>【Java】多线程与高并发 ｜ 我是猫</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      
        
          
        
        <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism.min.css" />
      
      
        <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1/plugins/line-numbers/prism-line-numbers.min.css" />
      
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->

  
<link rel="stylesheet" href="/css/scrollbar.css">
<link rel="stylesheet" href="/css/indeximg-hover.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"jjjime.github.io","root":"/","version":"1.8.12","typing":{"enable":false,"typeSpeed":60,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"touch","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":2},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname"}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>我是猫</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                Links
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" target="_blank" rel="noopener" href="http://110.40.191.51:5000/">
                <i class="iconfont icon-apple-fill"></i>
                桌面
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/admin/">
                <i class="iconfont icon-github-fill"></i>
                登录
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" false
         style="background: url('/images/uploads/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="【Java】多线程与高并发">
              
                【Java】多线程与高并发
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      不食花生的猫
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-07-03 10:33" pubdate>
        July 3, 2020 am
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      11k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      36 分钟
    </span>
  

  
  
</div>

            
          </div>

          
            <div class="scroll-down-bar">
              <i class="iconfont icon-arrowdown"></i>
            </div>
          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">【Java】多线程与高并发</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：a month ago
                
              </p>
            
            <div class="markdown-body">
              <h3 id="多线程与高并发-synchronized-篇"><a href="#多线程与高并发-synchronized-篇" class="headerlink" title="多线程与高并发 synchronized 篇"></a>多线程与高并发 synchronized 篇</h3><p><font color=DarkGray size=2>进程 线程 协程/纤程（Quasur）</font></p>
<hr>
<p><br><br></p>
<h4 id="线程：一个程序里不同的执行路径"><a href="#线程：一个程序里不同的执行路径" class="headerlink" title="线程：一个程序里不同的执行路径"></a>线程：一个程序里不同的执行路径</h4><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> T1 <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">&#123;</span>
  <span class="token annotation punctuation">@Override</span> 
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Override Theme 中的 run 方法"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 方法一</span>
<span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 方法二</span>
<span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 方法三</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>
	<span class="token class-name">Sout</span><span class="token punctuation">(</span><span class="token string">"Hello World！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<ul>
<li><p>创建线程的两种方式：</p>
<ul>
<li>创建一个类，继承Thread，重写方法</li>
<li>定义一个类，实现 Runnable 接口，然后重写 run 方法</li>
</ul>
</li>
<li><p>启动：</p>
</li>
</ul>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//方法一：</span>
<span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//方法二：</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//方法三：</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span> <span class="token class-name">Sout</span><span class="token punctuation">(</span><span class="token string">"Hello World！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<ul>
<li>面试<ul>
<li>问：启动线程的三种方式是？</li>
<li>答：<ul>
<li>1、从 <code>Thread</code> 继承</li>
<li>2、实现 <code>Runnable</code> 接口</li>
<li>3、从线程池中启动 <code>Executors.newCachedThrad</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<br>
<br>

<h4 id="线程的基本方法"><a href="#线程的基本方法" class="headerlink" title="线程的基本方法"></a>线程的基本方法</h4><p><font color =DarkGray size=2>在T1中调用  T2.join（）；则执行到 join 之后，<font color=#f123>T1进入等待模式</font>，先执行完T2之后，再返回执行T1。</font></p>
<hr>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// sleep 睡眠</span>
<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 毫秒</span>

<span class="token comment">// Yield 让出一下CPU 进入等待队列（如果没有等待的则继续执行）</span>
<span class="token comment">// 使用场景，较少</span>
<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Join</span>
<span class="token class-name">Thread</span> T1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>
    T1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token class-name">Thread</span> T2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>
    <span class="token class-name">Sout</span><span class="token punctuation">(</span><span class="token string">"T2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<ul>
<li>其他方法</li>
</ul>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 暴力结束线程（不建议使用）</span>
<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 唤起线程</span>
<span class="token punctuation">.</span><span class="token function">intereptor</span><span class="token punctuation">(</span> <span class="token punctuation">)</span>

<span class="token comment">// 获取线程状态。</span>
<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>






<p><br><br></p>
<h4 id="线程的锁"><a href="#线程的锁" class="headerlink" title="线程的锁"></a>线程的锁</h4><hr>
<ol>
<li>上锁</li>
</ol>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">//任何县城要执行下面的代码，则必须先拿到o</span>
        count<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// synchronized(this) 等值于 synchronized(方法);</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> count  <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">// 等同于synchronized(T.class)</span>
    	count <span class="token operator">--</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">mm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            count<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>


<p><br><br></p>
<h4 id="synchronized的特性"><a href="#synchronized的特性" class="headerlink" title="synchronized的特性"></a>synchronized的特性</h4><p><font color=DarkGray size=2>1、锁的是对象，不是进程  / 线程 ； 2、能不加synchronized()锁就不加，加锁之后效率极低；</font></p>
<hr>
<ul>
<li><p>可重入性</p>
<ul>
<li>一个方法<code>m1</code>加锁，另一个方法<code>m2</code>也加了锁（同一把锁），那么<code>m1</code>是可以调用<code>m2</code>的。</li>
</ul>
</li>
<li><p>异常的锁</p>
<ul>
<li>程序中的锁的内容出现了<font color=#f123><strong>异常</strong></font>，那么该锁将被<font color=#f890>释放</font>。</li>
</ul>
</li>
</ul>
<hr>
<p><br><br></p>
<h4 id="synchronized-底层实现"><a href="#synchronized-底层实现" class="headerlink" title="synchronized 底层实现"></a>synchronized 底层实现</h4><p><font color=DarkGray size=2>synchronized(Object) ;  括号中一定要是Object对象，不能是String 或其他任何类型；</font></p>
<hr>
<blockquote>
<p>早期的锁：需要就去找操作系统申请、</p>
</blockquote>
<blockquote>
<p>发展后的：先乐观锁、后自旋锁、最后找系统实现（重量级锁 | 最浪费时间）</p>
</blockquote>
<blockquote>
<ul>
<li><font color=DarkGray size=2>抱着“没有线程跟我争用”的心态去申请一个资源：此时是 <font color=#f890>偏向锁</font>，只记录ID，不锁（默认没有第二个线程来访问）</font></li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><font color=DarkGray size=2>如果有线程争用：升级为 <font color=#f890>自旋锁</font> 循环10次（占用CPU）</font></li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><font color=DarkGray size=2>10次之后要访问的资源还被锁着？升级为<font color=#f890>重量级锁 </font> 去操作系统申请锁（不占用 CPU）</font></li>
</ul>
</blockquote>
<p><font color=7bafa6 size=2>自旋锁：在用户态解决问题，不经过内核态。</font></p>
<p><font color=7bafa6 size=2>执行时间长的用系统锁，（加锁代码）执行时间特别短，线程较少，用自旋锁。</font></p>
<hr>
<p><br><br></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><hr>
<ul>
<li>Lock( )   CAS使用自旋</li>
<li>synchronized 是一种锁，其锁的目标是 对象 而不是线程 / 进程（用对象代替进程更易操作）</li>
<li>被锁的对象 必须是 Object 类型，不能是 String 或其他对象</li>
<li>锁申请资源的时候一定是    ：乐观锁</li>
<li>锁第一次升级的时候一定是：自旋锁（自旋十次，耗CPU，不走内核）</li>
<li>锁第二次升级的时候一定是：重量级锁（内核态，耗内核、耗时，不耗CPU）</li>
</ul>
<hr>
<p><br><br><br><br></p>
<h3 id="多线程与高并发-2-代码优化-及-volatile修饰-篇"><a href="#多线程与高并发-2-代码优化-及-volatile修饰-篇" class="headerlink" title="多线程与高并发 2  代码优化 及 volatile修饰 篇"></a>多线程与高并发 2  代码优化 及 volatile修饰 篇</h3><hr>
<p><br><br></p>
<h4 id="volatile-指令介绍"><a href="#volatile-指令介绍" class="headerlink" title="volatile 指令介绍"></a>volatile 指令介绍</h4><p><font color=DarkGray size=2>偏向锁  &gt;  循环锁  &gt;  重量级锁</font></p>
<hr>
<blockquote>
<ul>
<li><p>指令介绍</p>
<ul>
<li>volatile // 可变的，易变的</li>
</ul>
</li>
<li><p>指令功能</p>
<ul>
<li><p>保证线程可见性，禁止指令重排序。</p>
</li>
<li><p><font color=#f890>保证线程可见性：</font>一个类的值给两个类同时调用，里面的变量改变后无法轻易发现（线程之间不可见）。</p>
<p>volatile可以让一个线程发生改变之后，另一个线程可以马上知道。</p>
<p>// 原理：CPU的缓存一致性协议。</p>
</li>
<li><p><font color=#f890>禁止指令重排序：</font>CPU迸发执行指令，所以会对指令重新排序，加了volatile来保证重排序。</p>
</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<p><br><br></p>
<h4 id="举例介绍-及-代码优化"><a href="#举例介绍-及-代码优化" class="headerlink" title="举例介绍 及 代码优化"></a>举例介绍 及 代码优化</h4><hr>
<ul>
<li><font color=#f890>饿汉式</font>：（定义类的时候就实例化方法）</li>
</ul>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Mgr01</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Mgr01</span> INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mgr01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">Mgr01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Mgr01</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"m"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">Mgr01</span> m1 <span class="token operator">=</span> <span class="token class-name">Mgr01</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Mgr01</span> m2 <span class="token operator">=</span> <span class="token class-name">Mgr01</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m1 <span class="token operator">==</span> m2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<ul>
<li><font color=#f890>懒汉式：</font>什么时候调用方法什么时候初始化（类似于懒加载）</li>
</ul>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Lazy</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">Lazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token comment">//默认不会实例化，什么时候用什么时候new</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Lazy</span> lazy<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token class-name">Lazy</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>lazy<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                lazy<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Lazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        	<span class="token punctuation">&#125;</span>
        	<span class="token keyword">return</span> lazy<span class="token punctuation">;</span>
    	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">饿汉式</th>
<th align="center">懒汉式</th>
</tr>
</thead>
<tbody><tr>
<td align="center">安全</td>
<td align="center">√</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">节省内存</td>
<td align="center"></td>
<td align="center">√</td>
</tr>
</tbody></table>
<ul>
<li>懒汉饿汉合并：</li>
</ul>
<blockquote>
<p>类的定义：</p>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Mgr01</span><span class="token punctuation">&#123;</span>
<span class="token keyword">private</span> <span class="token comment">/*volatile*/</span> <span class="token keyword">static</span> <span class="token class-name">Mgr0x</span> INSTANCE<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">Mgr0x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Mgr01</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	<span class="token comment">//以下所有代码写的都是这一个方法</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<p><font color=#f890>以下所有方法写的都是上面的 <code>getInstance（）</code>方法。</font></p>
<p><font color=7baf23 size=3>以上方法没有加<code>volatile</code>，最后会写上。</font></p>
<hr>
<ul>
<li>直接判断null</li>
</ul>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 先判断是否为空 然后再那啥：</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Mgr03</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>INSTANCE <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruotedException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mgr03</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<p><font color=#f123 size=2>  ↑   ↑   ↑   ↑    ↑ 这是一种错误的书写方式，自己抿；</font></p>
<ul>
<li>先锁再null</li>
</ul>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token class-name">Mgr04</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>INSTANCE <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruotedException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mgr04</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<p><font color=7baf23 size=2>  ↑   ↑   ↑   ↑    ↑ 修改正确，但是违背了  <font color=#f890 size=3>能不加锁就不加锁</font>  原则。</font></p>
<ul>
<li>锁细化：</li>
</ul>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Mgr05</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>INSTANCE <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Mgr05</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruotedException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mgr05</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<p><font color=#f123 size=2>  ↑   ↑   ↑   ↑    ↑ 这也是一种错误的书写方式（重复初始化）；</font></p>
<ul>
<li>双重检查：</li>
</ul>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Mgr05</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>INSTANCE <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Mgr05</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>INSTANCE <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruotedException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mgr05</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<p><font color=7baf23 size=2>  ↑   ↑   ↑   ↑    ↑ 修改正确…….而且锁不加载外面，效率增高~~</font></p>
<ul>
<li><font color=#ff452>关于<code>volatile</code>(主要是   <font size=5 color=#f890><code>指令重排序</code>   </font>)超高超高迸发的情况可能会发生：</font></li>
</ul>
<blockquote>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// new对象的三步</span>
INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mgr06</span>（）<span class="token punctuation">;</span>

<span class="token number">1.</span> 申请内存并给初始值（<span class="token keyword">int</span> <span class="token operator">=</span> <span class="token number">0</span>，<span class="token class-name">String</span> <span class="token operator">=</span> <span class="token keyword">null</span>；）
<span class="token number">2.</span> 修改值
<span class="token number">3.</span> 将值给对象<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<p><font color=7baf23 size=2>加 <code>volatile</code> 防止第二步第三步会颠倒；</font></p>
<ul>
<li>一个求结果是 100000 的小程序</li>
</ul>
</blockquote>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">volatile</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 加上vilatile</span>
    <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">// 加上 synchronized</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>count<span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">T</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">></span></span> threads <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArraysList</span><span class="token operator">&lt;</span><span class="token operator">~</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            threads<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>t<span class="token operator">::</span><span class="token function">m</span><span class="token punctuation">,</span><span class="token string">"threads-"</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        threads<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token operator">-></span>o<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        threads<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>
          <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
              o<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
              e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<p><font color=#f890 size=2>只有加上了 synchronized &amp; volatile 才能运行出正确结果，其中 synchronized 用来保证<code>原子性</code>。</font></p>
</blockquote>
<hr>
<p><br><br></p>
<h4 id="锁优化场景"><a href="#锁优化场景" class="headerlink" title="锁优化场景"></a>锁优化场景</h4><hr>
<ul>
<li>锁力度变小（争用不是很激烈的话）</li>
</ul>
<blockquote>
<p>如果有一群要争用的代码，那么可以将方法上的 synchronized 写到 count++ 上；</p>
</blockquote>
<ul>
<li>锁力度变大（争用很激烈很频繁的话）</li>
</ul>
<blockquote>
<p>假如一个方法里面 总共 20 行代码，加了19个锁，那不如直接用一个大的锁。</p>
</blockquote>
<hr>
<p><br><br></p>
<h4 id="锁的对象被调用"><a href="#锁的对象被调用" class="headerlink" title="锁的对象被调用"></a>锁的对象被调用</h4><hr>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token operator">=</span> <span class="token class-name">T</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 错误修改点</span>
    
    <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token function">sout</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">zbc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">T</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span>o <span class="token operator">=</span> <span class="token string">"a"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<p><font color=#f123 size=2>↑   ↑   ↑  以上代码错误！</font><font color=7baf23 size=2>以下为修改 ↓   ↓   ↓</font></p>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div>

<p><br><br></p>
<h4 id="有些类在创建的时候直接加了锁"><a href="#有些类在创建的时候直接加了锁" class="headerlink" title="有些类在创建的时候直接加了锁"></a>有些类在创建的时候直接加了锁</h4><hr>
<blockquote>
<p>Atomic 开头的 ( <code>AtomicInteger  count = new AtomicInteger( );</code>  // 让count进行原子性加减)</p>
</blockquote>
<hr>
<p><br><br></p>
<h4 id="CAS-Compare-And-Set-无锁优化-乐观锁"><a href="#CAS-Compare-And-Set-无锁优化-乐观锁" class="headerlink" title="CAS ( Compare And Set ) 无锁优化 乐观锁"></a>CAS ( Compare And Set ) 无锁优化 乐观锁</h4><p><font color=#f890 size=2>在请求的时候就乐观的认为 代码里的值就是我的期望值</font></p>
<hr>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java">cas <span class="token punctuation">(</span><span class="token class-name">V</span> <span class="token punctuation">,</span><span class="token class-name">Expected</span><span class="token punctuation">,</span><span class="token class-name">NewValue</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> （<span class="token class-name">V</span> <span class="token operator">==</span> <span class="token class-name">Expected</span>）<span class="token punctuation">&#123;</span>
        <span class="token class-name">V</span> <span class="token operator">=</span> <span class="token class-name">NewValue</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        tryAgain or fail<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<p><font color=7baf23 size=2>↑   ↑   ↑  以上是在CPU 原语上的支持，不能被打断。</font></p>
<hr>
<p><br><br></p>
<h4 id="ABA-问题（与前女友复合之后，其实她已经经历了n个男人；）"><a href="#ABA-问题（与前女友复合之后，其实她已经经历了n个男人；）" class="headerlink" title="ABA 问题（与前女友复合之后，其实她已经经历了n个男人；）"></a><code>ABA</code> 问题（与前女友复合之后，其实她已经经历了<code>n个</code>男人；）</h4><hr>
<p>有个对象 object == 1；想使用<code>cas</code>把它变成2:</p>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token function">cas</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//没有线程进行操作，可以进行更改</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div>

<p><font color=#f890 size=2>如果在更改的时候有一个线程给 object 改成了2，然后又改成了 1 ；在基础类型（如：int）没有影响，但是 <code>Object</code> 对象有影响；</font></p>
<p><font color=7baf23 size=2>解决方法：做 <code>cas</code> 的时候加个版本号：</font>version</p>
<p><font color=7baf23 size=2>解决方法：使用</font>  AutomicStampedReference ( unsafe 什么时候调用什么时候返回这个值 )</p>
<hr>
<p><br><br></p>
<h4 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h4><hr>
<ul>
<li>什么是 volatile ？ 它有什么用？</li>
<li>什么是 synchronized ？ 什么是 CAS ？两者有什么区别？分别在什么场景下使用？</li>
<li>什么时候要对锁进行细化？什么 时候进行泛化？</li>
<li>什么是 ABA 问题？有什么影响？怎么解决？</li>
</ul>
<hr>
<p><br><br><br><br><br></p>
<h3 id="各式锁的实际应用"><a href="#各式锁的实际应用" class="headerlink" title="各式锁的实际应用"></a>各式锁的实际应用</h3><p><font color=DarkGray size=2>公平锁？不公平锁？乐观锁？悲观锁？自旋锁？重量级锁？读写锁？</font></p>
<hr>
<p><br><br></p>
<h4 id="乐观锁-cas"><a href="#乐观锁-cas" class="headerlink" title="乐观锁 cas"></a>乐观锁 <a target="_blank" rel="noopener" href="https://blog.csdn.net/ln_6am/article/details/85642853?ops_request_misc=%25257B%252522request%25255Fid%252522%25253A%252522160891401516780271139209%252522%25252C%252522scm%252522%25253A%25252220140713.130102334..%252522%25257D&request_id=160891401516780271139209&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-1-85642853.first_rank_v2_pc_rank_v29&utm_term=cas">cas</a></h4><p><font color=DarkGray size=2>（要改的对象，期望的值，要给的值）无锁操作，其实是一个乐观锁……cas本身可以看成是一个锁；</font></p>
<hr>
<ul>
<li>automic ： 一种使用 cas 实现的原子性操作（上篇中提过）</li>
</ul>
<hr>
<p><br><br></p>
<h4 id="原子操作的简单方法："><a href="#原子操作的简单方法：" class="headerlink" title="原子操作的简单方法："></a>原子操作的简单方法：</h4><hr>
<table>
<thead>
<tr>
<th>函数</th>
<th>效果</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>AtomicInteger a = new AtomicInteger(0);</td>
<td>int a = 0;</td>
<td>创建对象a并且赋初值为0；</td>
</tr>
<tr>
<td>a.incrementAndGet(   )；</td>
<td>i++;</td>
<td>对原值+1后返回；</td>
</tr>
<tr>
<td>a.getAndIncrement(   )；</td>
<td>++i；</td>
<td>对原值返回后+1；</td>
</tr>
<tr>
<td>a.addAndGet(i);</td>
<td>a+=i;</td>
<td>返回a+i；</td>
</tr>
<tr>
<td>a.getAndAdd(i);</td>
<td>a+=i;</td>
<td>返回原值之后给a+i；</td>
</tr>
</tbody></table>
<p><font color = green>在线程很多的情况下：LongAdder（分段锁：在线程多的时候有优势） &gt; Atomic &gt; synchronized。</font></p>
<hr>
<p><br><br></p>
<h4 id="Synchronized-的可重入性："><a href="#Synchronized-的可重入性：" class="headerlink" title="Synchronized 的可重入性："></a>Synchronized 的可重入性：</h4><hr>
<blockquote>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//可重入：</span>
<span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">m1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token keyword">try</span><span class="token punctuation">&#123;</span>
	<span class="token class-name">TimeUtil</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 睡一秒</span>
	<span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token function">sout</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">m2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">sout</span><span class="token punctuation">(</span><span class="token string">"m2..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token class-name">T01_ReentrantLock1</span> r1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T01_ReentrantLock1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>r1<span class="token operator">::</span><span class="token function">m1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span><span class="token punctuation">&#123;</span>
<span class="token class-name">TimeUtil</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 睡一秒</span>
<span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>r1<span class="token operator">::</span><span class="token function">m2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<blockquote>
<p>输出结果：0 1 23 4 5 6 7 8 9 m2…</p>
</blockquote>
<p>代码修改：synchronized</p>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//可重入：</span>
<span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">m1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
    	<span class="token class-name">TimeUtil</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 睡一秒</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">sout</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    	<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>r1<span class="token operator">::</span><span class="token function">m2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">m2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">sout</span><span class="token punctuation">(</span><span class="token string">"m2..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token class-name">T01_ReentrantLock1</span> r1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T01_ReentrantLock1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>r1<span class="token operator">::</span><span class="token function">m1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">TimeUtil</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 睡一秒</span>
  <span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<blockquote>
<p> 输出结果：0 1 2 m2 … 3 4 5 6 7 8 9</p>
</blockquote>
</blockquote>
<hr>
<p><br><br></p>
<h4 id="lock-替代-synchronized-的方法"><a href="#lock-替代-synchronized-的方法" class="headerlink" title="lock():替代 synchronized 的方法;"></a><code>lock()</code>:替代 synchronized 的方法;</h4><hr>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div>

<ul>
<li><p>特点：</p>
<ul>
<li>需要手动上锁 <code>lock.lock( );</code></li>
<li>需要手动解锁<code>lock.unlock( )</code>;</li>
<li>防止进程出错而导致死锁，需要<code>try&#123; …… &#125;catch( )&#123; …… &#125;</code></li>
</ul>
<hr>
</li>
<li><p>优点：</p>
<ul>
<li><p>可以使用<code>tryLock()</code>尝试上锁；</p>
</li>
<li><p>当 <code>synchronized</code>遇到锁之后只能等待，而<code>tryLock()</code>可以自定义等待时间；</p>
</li>
<li><p>```java<br>locked = lock.tryLock(SECONDS(时间长度),TimeUtil.SECONDS（时间格式：秒）);</p>
<div class="code-wrapper"><pre class="line-numbers language-none"><code class="language-none">
  ----

- 常用方法：

| 方法                          | 参数                 | 用法                                                         |
| ----------------------------- | -------------------- | ------------------------------------------------------------ |
| .lock( );                     | null                 | 锁定                                                         |
| .unlock( );                   | null                 | 释放                                                         |
| .tryLock(n,TimeUtil.SECONDS); | 时间长度&lt;br&gt;时间单位 | 等待&#96;参数&#96;时间过程中:&lt;br&#x2F;&gt;如果当前进程释放了，则锁定;&lt;br&#x2F;&gt;不释放则不锁定； |
| .lockInterruptibly( );        | null；               | 可以相应被打断的锁；                                         |
| .interrupt( );                | Null;                | 打断这个锁；                                                 |


-----


&lt;br&gt;&lt;br&gt;


#### 公平锁

&lt;font size&#x3D;2&gt;ReetrantLock lock &#x3D; new ReentrantLock( &lt;font color&#x3D;#f890&gt;true&lt;&#x2F;font&gt; );&lt;&#x2F;font&gt;

----

- 概念：
  - 当执行队列中有线程正在排队的时候：
    - 公平锁：继续等待，排队执行；
    - 不公平锁：不等待，直接抢，有可能抢到第一个执行；
- 创建方式：
  - 在创建锁的时候加个 &#96;true&#96; 创建出来的就是公平锁；

&#96;&#96;&#96;java
public class T05_ReentrantLock extends Thread()&#123;
	private stratic ReentrantLock lock &#x3D; new ReentrantLock(true);
  public void run()&#123;
    for(int i &#x3D; 0;i&lt;100;i++)&#123;
      lock.lock();
      try&#123;
        Sout(Thread.currentThread().getName()+&quot;获得锁&quot;);
      &#125;finally&#123;
        lock.unlock();
      &#125;
    &#125;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></li>
</ul>
</li>
</ul>
<p><br><br></p>
<h4 id="一个倒计时的门栓-CountDownLatch"><a href="#一个倒计时的门栓-CountDownLatch" class="headerlink" title="一个倒计时的门栓 CountDownLatch"></a>一个倒计时的门栓 <code>CountDownLatch</code></h4><hr>
<p><code>CountDownLatch latch  = CountDownLatch( threads.length ); </code>    //创建一个length长度的门栓</p>
<p><code>.await()</code>   阻塞</p>
<p><code>原join()</code>    当前线程结束自动往前走</p>
<p><code>.countDown()</code>   原子性–</p>
<hr>
<p><br><br></p>
<h4 id="栅栏工具-CyclicBarrier"><a href="#栅栏工具-CyclicBarrier" class="headerlink" title="栅栏工具 CyclicBarrier"></a>栅栏工具 <code>CyclicBarrier</code></h4><p><font color=#dgreen size=2>循环栅栏工具</font></p>
<hr>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 一个参数：不到20的时候，等待，到了20个，这20个发车，再来的继续等待</span>
<span class="token class-name">CyclicBarrier</span> barrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 两个参数：</span>
<span class="token class-name">CyclicBarrier</span> barrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token number">20</span>，run<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token class-name">Sout</span><span class="token punctuation">(</span><span class="token string">"满员，发车！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token comment">//lambdo 表达式</span>
<span class="token class-name">CyclicBarrier</span> barrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token number">20</span>，<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token class-name">Sout</span><span class="token punctuation">(</span><span class="token string">"满员，发车！"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<p><br><br></p>
<h4 id="同步进行的-Phaser"><a href="#同步进行的-Phaser" class="headerlink" title="同步进行的 Phaser"></a>同步进行的 Phaser</h4><p><font size=2>按照不同的阶段对线程进行划分。</font></p>
<hr>
<ul>
<li><p>使用场景：</p>
<ul>
<li>遗传算法</li>
<li>现实生活一步一步执行的场景（如：婚礼）</li>
<li>像是一个一个栅栏一样</li>
</ul>
<hr>
</li>
<li><p>使用方法：</p>
<ul>
<li><p>自定义一个类，继承 <code>Phaser</code>类；</p>
<p><code>static class MarrigePhaser extends Phaser</code></p>
</li>
<li><p>重写<code>onAdvance</code>方法；（栅栏被推倒的时候自动调用）</p>
<p><code>protected boolean onAdvance(int phase,int registeredParties)</code></p>
</li>
</ul>
<hr>
</li>
<li><p>方法：</p>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java">phaser<span class="token punctuation">.</span><span class="token function">arriveAndAwaitAdvance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//执行结束，开始等待；</span>
phaser<span class="token punctuation">.</span><span class="token function">arriveAndDeregister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//执行结束，不进入下一阶段；</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div></li>
</ul>
<p><br><br></p>
<h4 id="读写锁"><a href="#读写锁" class="headerlink" title="读写锁"></a>读写锁</h4><p><font size=2>程序中的读写锁（一种排他锁、共享锁）</font></p>
<hr>
<ul>
<li><p>概念</p>
<ul>
<li>当<code>A</code>进程在读取<code>ABCD</code>的时候，<code>B</code>进程也来读取<code>ABCD</code>，同时发现<code>A</code>进程在读取，则读取成功；</li>
<li>当<code>A</code>进程在<font color=7baf23>读取</font><code>ABCD</code>的时候，<code>B</code>进程来<font color=#f890>修改</font><code>ABCD</code>，同时发现<code>A</code>进程在读取，若此时更改<code>ABCD</code>的内容，则<code>A</code>进程读取会出问题，所以修改失败；</li>
<li><strong>总结：</strong>两个都是<font color=7baf23>读取</font>的进程可以同时进行，当有 读 进程在进行时，<font color=red>无法</font>进行 <font color=red>写</font> 进程，写同理；</li>
</ul>
</li>
<li><p>作用</p>
<ul>
<li>避免 / 减少 脏数据</li>
</ul>
</li>
</ul>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token class-name">ReadWriteLoak</span> readWriteLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//在 ReentrantReadWriteLock 中 分出一个 `readLock`一个`writeLock`</span>
<span class="token keyword">static</span> <span class="token class-name">Lock</span> readLock <span class="token operator">=</span> readWriteLock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token class-name">Lock</span> writeLock <span class="token operator">=</span> readWriteLock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">Lock</span> lock<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Sout</span><span class="token punctuation">(</span><span class="token string">"read over!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 模拟读取过程</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        e<span class="token punctuation">.</span><span class="token function">peintStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">finally</span><span class="token punctuation">&#123;</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">Lock</span> lock<span class="token punctuation">,</span><span class="token keyword">int</span> a<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Sout</span><span class="token punctuation">(</span><span class="token string">"write "</span><span class="token operator">+</span> a <span class="token operator">+</span><span class="token string">"over!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 模拟读取过程</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        e<span class="token punctuation">.</span><span class="token function">peintStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">finally</span><span class="token punctuation">&#123;</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
    
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    
    <span class="token class-name">Runnable</span> readR <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">read</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token comment">//Runnable readR = ()->read(readLock);</span>
    
    <span class="token class-name">Runnable</span> write <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">write</span><span class="token punctuation">(</span>lock<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">18</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>readR <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">2</span> <span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>writeR<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<p>// 如果使用 <code>ReentrantLock</code>的话，以上代码在执行<code>读</code>的时候也需要等待一秒；</p>
<p>// 解决方法：将<code>Main</code>方法中的<code>读</code>锁换成`Runnable readR = ()-&gt; read(readLock);<br></p>
<br>

<hr>
<p><br><br></p>
<h4 id="Semaphore-一个有意思的线程池"><a href="#Semaphore-一个有意思的线程池" class="headerlink" title="Semaphore 一个有意思的线程池"></a>Semaphore 一个有意思的<font color=#FFA500>线程池</font></h4><p><font color=DarkGray size=2><code>Semaphore s = new Semaphore(x);</code>x是几则这个 &lt; 线程池 &gt; 就   <font color=#f890 size=2>允许几个线程</font>    同时执行。</font></p>
<hr>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">Semaphore</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//括号中数字为x时，允许x个线程同时执行</span>
    
    <span class="token comment">// T1 Running</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
            s<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 进来一个进程 1 变成 0 ，别的线程不能执行</span>
            <span class="token class-name">Sout</span><span class="token punctuation">(</span><span class="token string">"T1 Running"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Sout</span><span class="token punctuation">(</span><span class="token string">"T1 Running"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">finally</span><span class="token punctuation">&#123;</span>
            s<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 离开一个进程 0 变成 1 ，别的线程可以执行</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token comment">// T2 Running</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
            s<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 进来一个进程 1 变成 0 ，别的线程不能执行</span>
            <span class="token class-name">Sout</span><span class="token punctuation">(</span><span class="token string">"T2 Running"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Sout</span><span class="token punctuation">(</span><span class="token string">"T2 Running"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">finally</span><span class="token punctuation">&#123;</span>
            s<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 离开一个进程 0 变成 1 ，别的线程可以执行</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<p><font color = #f890 size=2>如果<code>x==1</code>则运行结果是<code>T1 T1 T2 T2</code>，否则可能是<code>T1 T2 T1 T2</code></font></p>
<p><br><br></p>
<h4 id="Exchanger-用于-lt-两个-gt-线程交换数据的方法"><a href="#Exchanger-用于-lt-两个-gt-线程交换数据的方法" class="headerlink" title="Exchanger 用于 &lt; ! 两个 ! &gt; 线程交换数据的方法"></a>Exchanger 用于 &lt; ! 两个 ! &gt; 线程交换数据的方法</h4><p><font color=DarkGray size=2>使用场景：双人游戏中两人交换装备！执行一次就失效，可以循环等待下一次；</font></p>
<hr>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token comment">// T1</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">"T1"</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
            s <span class="token operator">=</span> sxchanger<span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token function">cathc</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">Sout</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">""</span><span class="token operator">+</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"t1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// T2</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">"T2"</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
            s <span class="token operator">=</span> sxchanger<span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token function">cathc</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">Sout</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">""</span><span class="token operator">+</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"t2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<blockquote>
<p>线程中有两个变量，分别是 s 和 s （局部变量），两个线程同时执行，最后交换 T1 与 T2 的值；</p>
</blockquote>
<hr>
<p><br><br></p>
<h4 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h4><hr>
<p><font color=#f890 size=2>只是某个类型的锁，将来补充概念。</font></p>
<p><br><br></p>
<h4 id="总结-："><a href="#总结-：" class="headerlink" title="总结 ："></a>总结 ：</h4><hr>
<ul>
<li>无论何种情况，优先考虑使用<code>synchronized</code></li>
<li>什么情况下使用lock（）？它与 synchronized（）相比有什么优点？</li>
<li>为什么使用读写锁？读写锁是怎么实现的？</li>
<li>随机列举一些跟锁一起使用的方法~~</li>
<li>把标题下的各种锁的使用场景和实现方式全都想一遍~</li>
</ul>
<hr>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Java/">Java</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Java/">Java</a>
                    
                      <a class="hover-with-bg" href="/tags/%E8%BF%9B%E9%98%B6/">进阶</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/11/21/%E3%80%90%E8%AF%95%E3%80%91HashCat-%E5%8F%82%E6%95%B0/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">【试】HashCat 参数</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/05/03/%E3%80%90Java%E3%80%91Lambda-%E8%A1%A8%E8%BE%BE%E5%BC%8F/">
                        <span class="hidden-mobile">【Java】Lambda 表达式</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="lv-container" data-id="city" data-uid="MTAyMC81NDM5Mi8zMDg2Mw==">
    <script type="text/javascript">
      Fluid.utils.loadComments('#lv-container', function() {
        Fluid.utils.createScript('https://cdn-city.livere.com/js/embed.dist.js');
      });
    </script>
    <noscript>Please enable JavaScript to view the comments</noscript>
  </div>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目錄</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜尋</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">關鍵字</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            &nbsp✨&nbsp 
            <span id="busuanzi_value_site_pv"></span>
             times
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            &nbsp💫&nbsp 
            <span id="busuanzi_value_site_uv"></span>
             nums
          </span>
      
    
  </div>


  
  <!-- 备案信息 -->
  <div class="beian">
    <span>
      <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
        备案号：鲁ICP备2022010174号
      </a>
    </span>
    
  </div>


  
</footer>




  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  
    
  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>








  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        loader: {
          load: ['ui/lazy']
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" ></script>

  





  <script  src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js" ></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({"theme":"default"});
    }
  </script>




  

  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
